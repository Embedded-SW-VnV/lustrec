OCAMLBUILD=@OCAMLBUILD@ -classic-display -no-links 

prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@
datarootdir = ${prefix}/share
includedir = ${prefix}/include

LUSI_LIBS=include/math.lusi include/conv.lusi include/mpfr_lustre.lusi

LOCAL_BINDIR=bin
LOCAL_DOCDIR=doc/manual

lustrec:
	@echo Compiling binary lustrec
	@make -C src lustrec

doc:
	@echo Generating doc
	@make -C src doc

dot: doc
	@make -C src dot

clean:
	@make -C src clean
	@rm -f  $(LUSI_LIBS:%.lusi=%.lusic) $(LUSI_LIBS:%.lusi=%.h)

dist-clean: clean

%.lusic: %.lusi 
	@echo Compiling $<
	@$(LOCAL_BINDIR)/lustrec $(OPTION_LUSIC) -verbose 0 -d include $< 

include/mpfr_lustre.lusic: OPTION_LUSIC=-mpfr 1

compile-lusi: lustrec $(LUSI_LIBS:%.lusi=%.lusic)

install: compile-lusi
	mkdir -p ${bindir}
	install -m 0755 $(LOCAL_BINDIR)/* ${bindir}
	mkdir -p ${includedir}/lustrec
	cp include/* ${includedir}/lustrec

.PHONY: compile-lusi doc dot lustrec lustrec.odocl clean install dist-clean

